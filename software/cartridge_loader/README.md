# Cartridge Loader
The ZX Spectrum wasn't originally designed to have cartridge support, I assume this was due to the rather excessive costs involved in creating one-off hardware like this at the time when it was designed. The expansion connector at the back of the computer did however have the capability of disabling the system ROM found inside the machine, no doubt with the intention of allowing peripherals to upgrade the machine in this way.

This is what they did with the release of the Sinclair Interface 1, replacing the built-in ROM with one that supported the Microdrive and RS232 hardware that it added. The Interface 2 that was released sometime later did not come with a ROM by itself, this was moved onto individual cartridges like what people at that point had come to expect. The did however make a few mistakes, the biggest one was designing it in a way that made it hard to access more than the initial 16K ROM found on the cartridge - at a time when games had started to adopt the larger capabilities of the 48K machines. While I've sought to improve the hardware side of things when designing the *ZX Interface 2.021*, it still sees software in 16K segments and we need some software to handle switching between the 16K banks.

![Boot screen](https://github.com/tebl/ZX-Interface-2.021/raw/main/gallery/2021-04-25%2001.12.02.jpg)

The *Cartridge Loader* is the software-side of my solution for supporting more than one 16K games or applications on a single cartridge. Placing it in the first 16K bank of a cartridge, will allow the routines to prepare the computer for running machine code (setting up CPU registers and so on) before showing a boot screen. In order to allow us to switch out the first 16K bank for something else, we'll need to relocate the program into RAM instead before starting to execute instructions from there instead. At this point the user will be presented with a menu, selecting one of the items will switch over to the specified bank and at this point we can start the program we want to run. Check out the [documentation](https://github.com/tebl/ZX-Interface-2.021/blob/main/documentation/) for a separate document on [bank switching](https://github.com/tebl/ZX-Interface-2.021/blob/main/documentation/bank_switching.md).

![Loader menu](https://github.com/tebl/ZX-Interface-2.021/raw/main/gallery/2021-04-25%2001.12.04.jpg)

 That should just about cover it when it comes to describing what the *Cartridge Loader* does, but for those that just want to create their own cartridge compilations and have fun doing that - I've put together a [Cartridge Creator](https://github.com/tebl/ZX-Interface-2.021/tree/main/software/cartridge_creator) that for the most part automates dealing with the loader.

# 1> Assembling the code
This section is mostly for those that want to reprogram parts of the loader, the binary files are included in the repository so unless you want to assemble it yourself there shouldn't be a need to actually do so. The program is written in Z80 Machine Language, and as everyone who's attempted to do so - there is a lot of differences in the code due to the various dialects used by the assembler, every program therefore needs to be paired with the assesmbler it was written for.

The one I'm using is the [SB-Assembler 3](https://www.sbprojects.net/sbasm/index.php), it is open source and written in [Python](https://www.python.org/) so you should be able to use it on all common platforms without issues - just download and unzip the assembler files somewhere you'll be able to find them. I'm using Windows, for some reason, so there are batch-files accompanying the source code - these assume that you've added the location of the assembler in your PATH-variable. Double-click the file named *__assemble.bat* to assemble the output, then pause to allow you to actually see the command-line output before the batch execution finishes.

I've tried quite a few solutions for developing, assembling and testing out code for the ZX Spectrum and most of them quite simply don't work or can be considered more *proofs of concept* rather than usable setups. Your mileage may wary though, but this is the state of things as I see it. Most emulators are quite good at playing games, but they have varying amounts of helpful tools when it comes to testing out new code. For developing the *Cartridge Loader*, a cartridge ROM, the solution that worked for me was the ZXSpin emulator and using *Tools -> Options... -> ROM Images* and setting *ROM Image* to point to the file generated by the assembler (*loader.rom*).

![ZXSpin Options](https://github.com/tebl/ZX-Interface-2.021/raw/main/gallery/ZXSpin_Options.png)

# 2> References
Everything comes from something, so does every bit of code created from earlier code found in manuals and blogs. Particularly was a series of blog posts on a site called [Break into program](http://www.breakintoprogram.co.uk/) as well as a copy of *Spectrum Machine language for the absolute beginner* by William Tang.